// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               Int       @id @default(autoincrement())
  email            String    @unique
  name             String
  password         String
  role             String    // 'admin', 'cliente', 'motorista'
  cnpj             String?
  phone            String?
  company          String?
  
  // Relações
  viagensCliente   Viagem[]  @relation("Cliente")
  viagensMotorista Viagem[]  @relation("Motorista")
  messages         Message[]
}

model Viagem {
  id           Int       @id @default(autoincrement())
  codigo       String    @unique
  descricao    String
  valor        Float
  status       String    // 'pendente', 'em rota', 'entregue', 'cancelado'
  
  // Rota
  origem       String
  destino      String
  lat          Float
  lng          Float
  destLat      Float
  destLng      Float
  
  otp          String
  
  // Detalhes do Veículo e Carga
  veiculo      String?
  peso         String?
  dimensoes    String?
  
  // Controle
  canceled     Boolean   @default(false)
  cancelReason String?
  
  // Feedback e Finalização
  rating       Int?
  feedback     String?
  feedbackDate DateTime?
  signature    String?   // Base64 da assinatura (texto longo)
  
  // Histórico e Checklist (JSON puro para flexibilidade)
  history      Json?     
  checklist    Json?     

  // Relações
  clienteId    Int
  cliente      User      @relation("Cliente", fields: [clienteId], references: [id])
  motoristaId  Int?
  motorista    User?     @relation("Motorista", fields: [motoristaId], references: [id])
  messages     Message[]

  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
}

model Message {
  id         Int      @id @default(autoincrement())
  text       String
  timestamp  DateTime @default(now())
  
  viagemId   Int
  viagem     Viagem   @relation(fields: [viagemId], references: [id])
  
  senderId   Int
  sender     User     @relation(fields: [senderId], references: [id])
}

model Veiculo {
  id          Int     @id @default(autoincrement())
  placa       String  @unique
  modelo      String
  tipo        String
  capacidade  String?
  status      String  @default("ativo")
  ano         Int?
}